{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n// 파일이 늘때마다 고유 번호가 저장됨 (삭제해도 지워지지 않음)\nlet fileNo = 0;\n// 전체 파일 목록을 담을 배열 (삭제해도 지워지지 않음)\nlet filesArr = new Array();\n// 삭제한 파일들의 고유 번호 담기\nlet filesArr_del = new Array();\nimport Header from \"@/components/common/Header.vue\";\nexport default {\n  name: \"question_public_fix\",\n  data: function () {\n    return {\n      filelist: null,\n      s_dto: null,\n      user: JSON.parse(sessionStorage.getItem('user'))\n    };\n  },\n  components: {\n    Header\n  },\n  created() {\n    if (sessionStorage.getItem('user') != null) {\n      location.href = \"/service/question-public\";\n    }\n  },\n  mounted() {\n    this.$axios.get('/service/question-public-fix').then(res => {\n      this.filelist = res.data.filelist;\n      this.s_dto = res.data.s_dto;\n      this.s_dto.description.replace(\"<br>\", \"\\r\\n\");\n      this.$axios.e_cont_detail_input.innerText = this.s_dto.description;\n    });\n  },\n  methods: {\n    service_allservice: function () {\n      location.href = '/service/allService';\n    },\n    service_question_member: function () {\n      location.href = '/service/question-member';\n    },\n    service_question_public: function () {\n      location.href = '/service/question-public';\n    },\n    e_file_detail_input_change: function () {\n      // 첨부파일 최대 개수\n      var maxFileCount = 5;\n      // 기존 추가된 첨부파일 갯수\n      var allFileCount = document.querySelectorAll('.fileList').length;\n      // 첨부 가능한 파일 추가 갯수\n      var possibleFileCount = maxFileCount - allFileCount;\n      // 첨부파일 최대 갯수 한도 초과\n      if (possibleFileCount == 0) {\n        alert(\"첨부파일은 최대 \" + maxFileCount + \"개 까지만 첨부가 가능합니다.\");\n      }\n\n      // 현재 선택된 파일 갯수, 첨부 가능한 파일 갯수 중 최솟값 (추가 가능한 갯수까지 한정으로 추가) \n      for (const file of this.$refs.e_file_detail_input.files) {\n        file.is_delete = false;\n        filesArr.push(file);\n        // 파일 내용 읽기\n        var reader = new FileReader();\n        // onload = 읽기 동작이 성공적으로 완료되었을 때\n        reader.onload = function () {\n          // 개별 파일을 저장\n          reader.readAsDataURL(file);\n        };\n        // 목록 추가\n        let html = '';\n        html += '<div id=\"file' + fileNo + '\" class=\"fileList\" ref=\"fileList\">';\n        html += '   <p class=\"filename\">' + file.name + '</p>';\n        html += '   <a class=\"filedelete\" onclick=\"deleteFile(' + fileNo + ');\">❌</a>';\n        html += '</div>';\n        // jquery 로 추가하면 자동으로 dom 으로 변환되어 추가됨\n        this.$refs.file_group.append(html);\n        fileNo++;\n      }\n      // 추가한 뒤 초기화\n      document.querySelector(\"input[type=file]\").value = \"\";\n    },\n    deleteFile(num) {\n      // 이미 삭제된 파일 해당 인덱스에 .is_delete = true 라는 키와 값을 추가해 구분\n      document.querySelector(\"#file\" + num).remove();\n      filesArr[num].is_delete = true;\n    },\n    prev_deleteFile(num) {\n      document.querySelector(\"#prev_file\" + num).remove();\n      filesArr_del.push(num);\n    },\n    e_btn_fix_btn_click: function (e) {\n      e.preventDefault();\n      // 폼 데이터에 값 담기\n      let formData = new FormData();\n      // 삭제한 파일 있으면 담기\n      if (filesArr_del.length >= 1) {\n        for (let i = 0; i < filesArr_del.length; i++) {\n          formData.append('file_del_num', filesArr_del[i]);\n        }\n      } else {\n        // null 방지 파일 값 전달\n        formData.append('file_del_num', \"\");\n      }\n      // 파일을 폼데이터에 담기\n      for (let i = 0; i < filesArr.length; i++) {\n        // 삭제되지 않은 파일만 폼데이터에 담기\n        if (!filesArr[i].is_delete) {\n          formData.append('file' + i, filesArr[i]);\n        }\n      }\n      formData.append('title', this.$refs.e_ti_detail_input.value);\n      formData.append('description', this.$refs.e_cont_detail_input.value);\n      formData.append('bno', this.$refs.e_bno.value);\n      this.$axios.post('/service/question-public-fix', formData, {\n        headers: {\n          processData: false,\n          contentType: false,\n          dataType: 'text'\n        }\n      }).then(res => {\n        alert('글이 수정되었습니다.');\n        location.href = res.data;\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}