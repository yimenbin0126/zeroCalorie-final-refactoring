{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport Header from \"@/components/common/Header.vue\";\n// 파일이 늘때마다 고유 번호가 저장됨 (삭제해도 지워지지 않음)\nlet fileNo = 0;\n// 전체 파일 목록을 담을 배열 (삭제해도 지워지지 않음)\nlet filesArr = new Array();\nexport default {\n  name: \"question_write\",\n  components: {\n    Header\n  },\n  created() {\n    if (sessionStorage.getItem('user') == null) {\n      location.href = \"/service/question-member\";\n    }\n  },\n  methods: {\n    service_allservice: function () {\n      location.href = '/service/allService';\n    },\n    service_question_member: function () {\n      location.href = '/service/question-member';\n    },\n    service_question_public: function () {\n      location.href = '/service/question-public';\n    },\n    e_file_detail_input_change: function () {\n      // 첨부파일 최대 개수\n      var maxFileCount = 5;\n      var allFileCount = document.querySelectorAll('.fileList').length;\n      var possibleFileCount = maxFileCount - allFileCount;\n      if (possibleFileCount == 0) {\n        alert(\"첨부파일은 최대 \" + maxFileCount + \"개 까지만 첨부가 가능합니다.\");\n      }\n      if (allFileCount > 0) {\n        var maxSize = 15 * 1024 * 1024;\n        var fileSize = this.$refs.e_file_detail_input.files[allFileCount - 1].size;\n        if (fileSize > maxSize) {\n          alert(\"첨부파일은 15MB 이내로 등록 가능합니다.\");\n          return false;\n        }\n      }\n      // 현재 선택된 파일 갯수, 첨부 가능한 파일 갯수 중 최솟값 (추가 가능한 갯수까지 한정으로 추가) \n      for (const file of this.$refs.e_file_detail_input.files) {\n        file.is_delete = false;\n        filesArr.push(file);\n        // 파일 내용 읽기\n        var reader = new FileReader();\n        // onload = 읽기 동작이 성공적으로 완료되었을 때\n        reader.onload = function () {\n          // 개별 파일을 저장\n          reader.readAsDataURL(file);\n        };\n        // 목록 추가\n        let html = '';\n        html += '<div id=\"file' + fileNo + '\" class=\"fileList\" ref=\"fileList\">';\n        html += '   <p class=\"filename\">' + file.name + '</p>';\n        html += '   <a class=\"filedelete\" onclick=\"deleteFile(' + fileNo + ');\">❌</a>';\n        html += '</div>';\n        // jquery 로 추가하면 자동으로 dom 으로 변환되어 추가됨\n        this.$axios.file_group.append(html);\n        fileNo++;\n      }\n      // 추가한 뒤 초기화\n      document.querySelector(\"input[type=file]\").value = \"\";\n    },\n    deleteFile(num) {\n      // 이미 삭제된 파일 해당 인덱스에 .is_delete = true 라는 키와 값을 추가해 구분\n      document.querySelector(\"#file\" + num).remove();\n      filesArr[num].is_delete = true;\n    },\n    e_btn_write_btn_click: function (e) {\n      e.preventDefault();\n      // 폼 데이터에 값 담기\n      let formData = new FormData();\n      // 파일을 폼데이터에 담기\n      for (let i = 0; i < filesArr.length; i++) {\n        // 삭제되지 않은 파일만 폼데이터에 담기\n        if (!filesArr[i].is_delete) {\n          formData.append('file' + i, filesArr[i]);\n        }\n      }\n      // 빈값 체크\n      if (!this.$refs.e_ti_detail_input.value) {\n        this.$refs.e_ti_detail_input.value = \" \";\n      }\n      if (!this.$refs.e_cont_detail_input.value) {\n        this.$refs.e_cont_detail_input.value = \" \";\n      }\n      var choice_val = '';\n      if (document.getElementById('question_member_c').selected) {\n        choice_val = 'question_member';\n      } else if (document.getElementById('question_guide_c').selected) {\n        choice_val = 'question_guide';\n      }\n      formData.append('title', this.$refs.e_ti_detail_input.value);\n      formData.append('description', this.$refs.e_cont_detail_input.value);\n      formData.append('sv_type', choice_val);\n      this.$axios.post('/service/question-write', formData, {\n        headers: {\n          processData: false,\n          contentType: false,\n          dataType: 'text'\n        }\n      }).then(res => {\n        // 데이터 null 값 없이 잘 전달됨\n        if (res.data == \"title_null\") {\n          alert('제목을 입력해 주세요.');\n        } else if (res.data == \"title_full\") {\n          alert('제목은 최대 50자 이하로 입력해주세요.');\n        } else if (res.data == \"description_null\") {\n          alert('내용을 입력해 주세요.');\n        } else if (res.data == \"description_full\") {\n          alert('내용은 최대 1000자 이하로 입력해주세요.');\n        } else {\n          alert('글이 작성되었습니다.');\n          location.href = \"/service/question-member\";\n        }\n      });\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}